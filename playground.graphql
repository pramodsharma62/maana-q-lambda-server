fragment fieldFields on Field {
  name
  kind
  modifiers
}

fragment lambdaFields on Lambda {
  id
  name
  serviceId
  runtime {
    id
  }
  code
  input {
    ...fieldFields
  }
  outputKind
  outputModifiers
  kinds {
    name
    fields {
      ...fieldFields
    }
  }
}

mutation createLambda {
  createLambda(
    input: {
      id: "common+age"
      name: "age"
      serviceId: "common"
      runtimeId: "Q+JavaScript"
      code: "const dob = new Date(input.person.dob); const dobYear = dob.getFullYear(); const now = new Date();const nowYear = now.getFullYear();output = nowYear - dobYear;"
      input: [{ name: "person", kind: "Person", modifiers: [NONULL] }]
      outputKind: "Int"
      outputModifiers: [NONULL]
      kinds: [
        {
          name: "Person"
          fields: [
            { name: "name", kind: "String", modifiers: [NONULL] }
            { name: "dob", kind: "Date", modifiers: [NONULL] }
          ]
        }
      ]
    }
  ) {
    ...lambdaFields
  }
}

mutation createLambda2 {
  createLambda(
    input: {
      id: "my_workspace+projectDob"
      name: "projectDob"
      serviceId: "my_workspace"
      runtimeId: "Q+JavaScript"
      code: "output = input.person.dob;"
      input: [{ name: "person", kind: "Person", modifiers: [NONULL] }]
      outputKind: "Date"
      outputModifiers: [NONULL]
      kinds: [
        {
          name: "Person"
          fields: [
            { name: "name", kind: "String", modifiers: [NONULL] }
            { name: "dob", kind: "Date", modifiers: [NONULL] }
          ]
        }
      ]
    }
  ) {
    ...lambdaFields
  }
}

query getLambda {
  getLambda(id: "common+age") {
    ...lambdaFields
  }
}

query listLambdas {
  listLambdas(serviceId: "common") {
    ...lambdaFields
  }
}

query listRuntimes {
  listRuntimes {
    id
    host
    language
  }
}

mutation deleteLambda {
  deleteLambda(id: "common+age")
}

mutation deleteService {
  deleteService(id: "common")
}

query listServices {
  listServices
}
